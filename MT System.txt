<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mail Tracking System</title>
<style>
body { margin:0; font-family:"Segoe UI", sans-serif; background:#f4f6f9; color:#333; }
a { text-decoration:none; color:inherit; cursor:pointer; }

/* ===== Auth Pages ===== */
.auth-body { display:flex; justify-content:center; align-items:center; height:100vh; background:#f0f2f5; }
.auth-container { background:white; padding:40px; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.2); width:320px; text-align:center; }
.auth-container input { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc; }
.auth-container button { width:100%; padding:10px; border:none; border-radius:8px; background:#800000; color:white; font-weight:bold; cursor:pointer; margin-top:8px; }
.auth-container button:hover { background:#800000; }
.auth-container p { margin-top:10px; }
.auth-container a { color:#800000; cursor:pointer; text-decoration:underline; }

/* ===== Sidebar ===== */
.sidebar {
  position:fixed;
  top:0; left:0;
  width:180px;
  height:100vh;
  background:#800000;
  color:white;
  padding:20px;
  transition:0.3s;
  overflow:hidden;
}
.sidebar h3 { text-align:left; margin-bottom:30px; font-size:22px; }
.sidebar ul { list-style:none; padding:0; }
.sidebar li { margin:15px 0; }
.sidebar li a { display:block; padding:8px; border-radius:5px; color:white; }
.sidebar li a.active { background:#660000; }
.sidebar li a span { display:inline; }
.sidebar.collapsed { width:60px; }
.sidebar.collapsed li a span { display:none; }
.collapse-btn {
  position:absolute;
  top:10px;
  right:-13px;
  width:36px;
  height:36px;
  background:#800000;
  border-radius:50%;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:20px;
  cursor:pointer;
  z-index:2000;
}

/* ===== Main Area ===== */
.main { margin-left:220px; padding:20px; display:none; transition:margin-left 0.3s; }
.main.shifted-collapsed { margin-left:60px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }

/* ===== Cards ===== */
.cards { display:grid; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr)); gap:20px; margin-bottom:20px; }
.card { background:white; padding:20px; border-radius:12px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.card h3 { margin:0; font-size:1.1em; color:#555; }
.card p { font-size:1.8em; margin:10px 0 0; font-weight:bold; }
.incoming { border-left:5px solid #3b82f6; }
.outgoing { border-left:5px solid #10b981; }
.pending { border-left:5px solid #f59e0b; }
.done { border-left:5px solid #22c55e; }
.overdue { border-left:5px solid #ef4444; }

/* ===== Alert Box ===== */
.alert-box { background:#fff3cd; color:#856404; padding:10px 15px; border-radius:8px; font-weight:500; display:none; margin-bottom:20px; }

/* ===== Table ===== */
table { width:100%; border-collapse:collapse; background:white; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
th, td { padding:12px 15px; text-align:left; border-bottom:1px solid #eee; }
th { background:#800000; color:white; }
tr:hover { background:#f1f5f9; }
select.status-select { padding:5px; border-radius:5px; }

/* ===== Search Box ===== */
#searchBox { padding:10px; border-radius:8px; border:1px solid #ccc; width:300px; margin-bottom:10px; }

/* ===== Add Mail Form ===== */
.add-mail-form { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-top:20px; max-width:600px; }
.add-mail-form h3 { margin-bottom:15px; }
.add-mail-form input, .add-mail-form select { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc; }
.add-mail-form button { padding:10px 20px; border:none; border-radius:8px; background:#800000; color:white; font-weight:bold; cursor:pointer; }
.add-mail-form button:hover { background:#660000; }

/* ===== Sections ===== */
.section { display:none; }
.section.active { display:block; }

/* ===== Status Row Colors ===== */
.status-Pending { background-color:#fef3c7; }
.status-Done { background-color:#d1fae5; }
.status-Overdue { background-color:#fee2e2; }
</style>
</head>
<body>

<!-- ===== Auth Pages ===== -->
<div class="auth-body" id="loginPage">
  <div class="auth-container">
    <h2>Staff Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red;"></p>
    <p><a onclick="showSignup()">Sign Up</a> | <a onclick="showForgot()">Forgot Password?</a></p>
  </div>
</div>

<div class="auth-body" id="signupPage" style="display:none;">
  <div class="auth-container">
    <h2>Staff Sign Up</h2>
    <input type="text" id="signupUser" placeholder="Username">
    <input type="password" id="signupPass" placeholder="Password">
    <button onclick="signup()">Sign Up</button>
    <p id="signupError" style="color:red;"></p>
    <p><a onclick="showLogin()">Back to Login</a></p>
  </div>
</div>

<div class="auth-body" id="forgotPage" style="display:none;">
  <div class="auth-container">
    <h2>Forgot Password</h2>
    <input type="text" id="forgotUser" placeholder="Username">
    <button onclick="forgotPassword()">Retrieve Password</button>
    <p id="forgotMsg" style="color:green;"></p>
    <p><a onclick="showLogin()">Back to Login</a></p>
  </div>
</div>

<!-- ===== Sidebar ===== -->
<div class="sidebar" id="sidebar">
  <h3>Mail Tracker</h3>
  <div class="collapse-btn" id="sidebarToggle" onclick="toggleSidebar()">×</div>
  <ul>
    <li><a onclick="showSection('dashboard')" id="link-dashboard"><span>Dashboard</span></a></li>
    <li><a onclick="showSection('addMail')" id="link-addMail"><span>Add New Mail</span></a></li>
    <li><a onclick="showSection('allMails')" id="link-allMails"><span>All Mails</span></a></li>
    <li><a onclick="showSection('reports')" id="link-reports"><span>Reports</span></a></li>
    <li><a onclick="showSection('generateReport')" id="link-generateReport"><span>Generate Report</span></a></li>
    <li><a onclick="logout()"><span>Logout</span></a></li>
  </ul>
</div>

<!-- ===== Main Area ===== -->
<div class="main" id="mainArea">

  <!-- Dashboard -->
  <div id="dashboard" class="section active">
    <header>
      <h2>Dashboard</h2>
      <div id="alert-box" class="alert-box"></div>
    </header>
    <div class="cards">
      <div class="card incoming"><h3>Incoming</h3><p id="incoming-count">0</p></div>
      <div class="card outgoing"><h3>Outgoing</h3><p id="outgoing-count">0</p></div>
      <div class="card pending"><h3>Pending</h3><p id="pending-count">0</p></div>
      <div class="card done"><h3>Done</h3><p id="done-count">0</p></div>
      <div class="card overdue"><h3>Overdue</h3><p id="overdue-count">0</p></div>
    </div>
  </div>

  <!-- Add Mail -->
  <div id="addMail" class="section">
    <header><h2>Add New Mail</h2></header>
    <div class="add-mail-form">
      <h3>Enter Mail Details</h3>
      <form id="mailForm">
        <label>Mail Type</label>
        <select id="mailType" required>
          <option value="">Select</option>
          <option value="Incoming">Incoming</option>
          <option value="Outgoing">Outgoing</option>
        </select>
        <label>Subject</label>
        <input type="text" id="subject" placeholder="Enter mail subject" required>
        <label>Sender</label>
        <input type="text" id="sender" placeholder="Enter sender name" required>
        <label>Receiver</label>
        <input type="text" id="receiver" placeholder="Enter receiver name" required>
        <label>Department</label>
        <input type="text" id="department" placeholder="Enter department" required>
        <label>Date</label>
        <input type="datetime-local" id="mailDate" required>
        <label>Status</label>
        <select id="status" required>
          <option value="">Select</option>
          <option value="Pending">Pending</option>
          <option value="Done">Done</option>
        </select>
        <button type="submit">Add Mail</button>
      </form>
    </div>
  </div>

  <!-- All Mails -->
  <div id="allMails" class="section">
    <header>
      <h2>All Mails</h2>
      <input type="text" id="searchBox" placeholder="Search by sender or department..." onkeyup="filterTable()">
    </header>
    <table id="mailTable">
      <thead>
        <tr>
          <th>Mail Type</th>
          <th>Subject</th>
          <th>Sender</th>
          <th>Receiver</th>
          <th>Department</th>
          <th>Date</th>
          <th>Status</th>
          <th>Added By</th>
        </tr>
      </thead>
      <tbody id="mail-tbody"></tbody>
    </table>
  </div>

  <!-- Reports -->
  <div id="reports" class="section">
    <header>
      <h2>Mail Reports</h2>
    </header>
    <table id="reportTable">
      <thead>
        <tr>
          <th>Mail Type</th>
          <th>Subject</th>
          <th>Sender</th>
          <th>Receiver</th>
          <th>Department</th>
          <th>Date</th>
          <th>Status</th>
          <th>Added By</th>
        </tr>
      </thead>
      <tbody id="report-tbody"></tbody>
    </table>
  </div>

  <!-- Generate Report -->
  <div id="generateReport" class="section">
    <header><h2>Generate Report</h2></header>
    <div class="add-mail-form">
      <label>Select Mail Type for Report:</label>
      <select id="reportFilter">
        <option value="All">All</option>
        <option value="Incoming">Incoming</option>
        <option value="Outgoing">Outgoing</option>
        <option value="Pending">Pending</option>
        <option value="Done">Done</option>
      </select>
      <button onclick="generateReport()">Generate</button>
      <table id="generatedReportTable" style="margin-top:20px;">
        <thead>
          <tr>
            <th>Mail Type</th>
            <th>Subject</th>
            <th>Sender</th>
            <th>Receiver</th>
            <th>Department</th>
            <th>Date</th>
            <th>Status</th>
            <th>Added By</th>
          </tr>
        </thead>
        <tbody id="generatedReportTbody"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
// ===== Auth & Users =====
if(!localStorage.getItem('users')) localStorage.setItem('users', JSON.stringify([{username:'staff1', password:'1234'}]));

function showLogin(){ document.getElementById('loginPage').style.display='flex'; document.getElementById('signupPage').style.display='none'; document.getElementById('forgotPage').style.display='none'; }
function showSignup(){ document.getElementById('loginPage').style.display='none'; document.getElementById('signupPage').style.display='flex'; document.getElementById('forgotPage').style.display='none'; }
function showForgot(){ document.getElementById('loginPage').style.display='none'; document.getElementById('signupPage').style.display='none'; document.getElementById('forgotPage').style.display='flex'; }

function login(){
  const uname=document.getElementById('username').value;
  const pwd=document.getElementById('password').value;
  const users=JSON.parse(localStorage.getItem('users'));
  const validUser=users.find(u=>u.username===uname && u.password===pwd);
  if(validUser){
    localStorage.setItem('loggedInUser', uname);
    document.getElementById('loginPage').style.display='none';
    document.getElementById('sidebar').style.display='block';
    document.getElementById('mainArea').style.display='block';
    updateDashboardCounts();
  } else document.getElementById('loginError').textContent="Invalid username or password";
}

function signup(){
  const uname=document.getElementById('signupUser').value;
  const pwd=document.getElementById('signupPass').value;
  const users=JSON.parse(localStorage.getItem('users'));
  if(users.find(u=>u.username===uname)){ document.getElementById('signupError').textContent="Username already exists"; return; }
  users.push({username:uname,password:pwd});
  localStorage.setItem('users', JSON.stringify(users));
  alert('Sign up successful! Please login.');
  showLogin();
}

function forgotPassword(){
  const uname=document.getElementById('forgotUser').value;
  const users=JSON.parse(localStorage.getItem('users'));
  const user=users.find(u=>u.username===uname);
  const msg=document.getElementById('forgotMsg');
  msg.style.color='green';
  msg.textContent=user?`Your password is: ${user.password}`:'Username not found';
}

function logout(){
  localStorage.removeItem('loggedInUser');
  document.getElementById('loginPage').style.display='flex';
  document.getElementById('sidebar').style.display='none';
  document.getElementById('mainArea').style.display='none';
}

window.onload=function(){
  const loggedInUser=localStorage.getItem('loggedInUser');
  if(loggedInUser){
    document.getElementById('loginPage').style.display='none';
    document.getElementById('sidebar').style.display='block';
    document.getElementById('mainArea').style.display='block';
    updateDashboardCounts();
  }
}

// ===== Sections =====
function showSection(sectionId){
  document.querySelectorAll('.section').forEach(sec=>sec.classList.remove('active'));
  document.querySelectorAll('.sidebar a').forEach(link=>link.classList.remove('active'));
  document.getElementById(sectionId).classList.add('active');
  const link=document.getElementById('link-'+sectionId);
  if(link) link.classList.add('active');
  if(sectionId==='reports') populateReports();
}

// ===== Sidebar Collapse =====
function toggleSidebar() {
  const sidebar=document.getElementById('sidebar');
  const main=document.getElementById('mainArea');
  const toggleBtn=document.getElementById('sidebarToggle');
  sidebar.classList.toggle('collapsed');
  main.classList.toggle('shifted-collapsed');
  toggleBtn.textContent = sidebar.classList.contains('collapsed') ? "=" : "×";
}

// ===== Mail Handling =====
document.getElementById('mailForm').addEventListener('submit', function(e){
  e.preventDefault();
  const mailType=document.getElementById('mailType').value;
  const subject=document.getElementById('subject').value;
  const sender=document.getElementById('sender').value;
  const receiver=document.getElementById('receiver').value;
  const department=document.getElementById('department').value;
  const mailDate=document.getElementById('mailDate').value;
  const status=document.getElementById('status').value;
  const addedBy=localStorage.getItem('loggedInUser') || 'Unknown';

  const tbody=document.getElementById('mail-tbody');
  const row=tbody.insertRow();
  row.insertCell(0).textContent=mailType;
  row.insertCell(1).textContent=subject;
  row.insertCell(2).textContent=sender;
  row.insertCell(3).textContent=receiver;
  row.insertCell(4).textContent=department;
  row.insertCell(5).textContent=mailDate;

  const statusCell=row.insertCell(6);
  const select=document.createElement('select');
  select.className="status-select";
  ["Pending","Done"].forEach(opt=>{
    const option=document.createElement('option'); option.value=opt; option.text=opt;
    if(opt===status) option.selected=true;
    select.add(option);
  });
  select.addEventListener('change',updateDashboardCounts);
  statusCell.appendChild(select);

  row.insertCell(7).textContent=addedBy;

  document.getElementById('mailForm').reset();
  updateDashboardCounts();
  showSection('allMails');
});

// ===== Dashboard Counts =====
function updateDashboardCounts(){
  const rows=document.querySelectorAll('#mailTable tbody tr');
  let incoming=0, outgoing=0, pending=0, done=0, overdue=0;
  const now=new Date();
  rows.forEach(row=>{
    const mailType=row.cells[0].textContent;
    const statusSelect=row.cells[6].querySelector('select');
    const status=statusSelect? statusSelect.value : row.cells[6].textContent;
    const dateStr=row.cells[5].textContent;
    const mailDate=new Date(dateStr);
    const diffHours=(now-mailDate)/(1000*60*60);

    if(mailType==="Incoming") incoming++;
    if(mailType==="Outgoing") outgoing++;
    if(status==="Pending") pending++;
    if(status==="Done") done++;

    let rowOverdue=false;
    if((mailType==="Incoming" && diffHours>=24 && status!=="Done") || (mailType==="Outgoing" && diffHours>=48 && status!=="Done")){
      overdue++; rowOverdue=true;
    }

    row.classList.remove("status-Pending","status-Done","status-Overdue");
    if(rowOverdue) row.classList.add("status-Overdue");
    else if(status==="Pending") row.classList.add("status-Pending");
    else if(status==="Done") row.classList.add("status-Done");
  });

  document.getElementById('incoming-count').textContent=incoming;
  document.getElementById('outgoing-count').textContent=outgoing;
  document.getElementById('pending-count').textContent=pending;
  document.getElementById('done-count').textContent=done;
  document.getElementById('overdue-count').textContent=overdue;

  const alertBox=document.getElementById('alert-box');
  alertBox.style.display=overdue>0?'block':'none';
  alertBox.innerHTML=overdue>0?`⚠ You have ${overdue} overdue mail(s)!`:'';
}

// ===== Filter =====
function filterTable(){
  const filter=document.getElementById('searchBox').value.toLowerCase();
  const rows=document.querySelectorAll('#mailTable tbody tr');
  rows.forEach(row=>{
    const sender=row.cells[2].textContent.toLowerCase();
    const dept=row.cells[4].textContent.toLowerCase();
    row.style.display=(sender.includes(filter)||dept.includes(filter))?'':'none';
  });
}

// ===== Reports =====
function populateReports(){
  const tbody=document.getElementById('report-tbody');
  tbody.innerHTML='';
  const rows=document.querySelectorAll('#mailTable tbody tr');
  rows.forEach(row=>{
    const newRow=tbody.insertRow();
    for(let i=0;i<8;i++){
      const cell=newRow.insertCell(i);
      if(i===6){
        const sel=row.cells[6].querySelector('select');
        const select=document.createElement('select');
        ["Pending","Done"].forEach(opt=>{
          const option=document.createElement('option'); option.text=opt;
          if(sel && sel.value===opt) option.selected=true;
          select.addEventListener('change',updateDashboardCounts);
          cell.appendChild(select);
        });
      } else cell.textContent=row.cells[i].textContent;
    }
  });
}

// ===== Generate Report =====
function generateReport(){
  const filter=document.getElementById('reportFilter').value;
  const tbody=document.getElementById('generatedReportTbody');
  tbody.innerHTML='';
  document.querySelectorAll('#mailTable tbody tr').forEach(row=>{
    const mailType=row.cells[0].textContent;
    const status=row.cells[6].querySelector('select').value;
    if(filter==='All' || mailType===filter || status===filter){
      const newRow=tbody.insertRow();
      for(let i=0;i<8;i++){
        const cell=newRow.insertCell(i);
        if(i===6){
          const select=document.createElement('select');
          ["Pending","Done"].forEach(opt=>{
            const option=document.createElement('option'); option.text=opt;
            if(opt===status) option.selected=true;
            cell.appendChild(select);
          });
        } else cell.textContent=row.cells[i].textContent;
      }
    }
  });
}

// ===== Overdue Notifications =====
setInterval(checkOverdueMails, 60000);
function checkOverdueMails(){
  const rows=document.querySelectorAll('#mailTable tbody tr');
  const now=new Date();
  let overdueIncoming=0, overdueOutgoing=0;
  rows.forEach(row=>{
    const mailType=row.cells[0].textContent;
    const status=row.cells[6].querySelector('select').value;
    const mailDate=new Date(row.cells[5].textContent);
    const diffHours=(now-mailDate)/(1000*60*60);
    if(mailType==="Incoming" && diffHours>=24 && status!=="Done") overdueIncoming++;
    if(mailType==="Outgoing" && diffHours>=48 && status!=="Done") overdueOutgoing++;
  });
  if(overdueIncoming>0 || overdueOutgoing>0){
    alert(`Overdue Notification!\nIncoming mails overdue: ${overdueIncoming}\nOutgoing mails overdue: ${overdueOutgoing}`);
  }
}
</script>
</body>
</html>
